# 开发文档

## 项目架构

### 核心功能模块
1. **日期转换模块**
   - 使用 Lunar-JavaScript 库进行公历与农历转换
   - 支持年、月、日、时辰的完整转换

2. **八字计算模块**
   - 天干地支计算
   - 四柱（年月日时）计算
   - 当前时间八字自动更新（1分钟间隔）

3. **五行分析模块**
   - 五行统计计算
   - 五行分布可视化
   - 失衡度分析算法

### 数据结构
```typescript
interface BaziResult {
  year: [string, string];    // 年柱天干地支
  month: [string, string];   // 月柱天干地支
  day: [string, string];     // 日柱天干地支
  hour: [string, string];    // 时柱天干地支
  solarDate: string;         // 公历日期
  lunarDate: string;         // 农历日期
  fiveElements: {            // 五行属性
    year: [string, string];
    month: [string, string];
    day: [string, string];
    hour: [string, string];
  };
}
```

## 开发历史

### 第一阶段：基础功能实现
1. 搭建 React + TypeScript 项目框架
2. 实现日期选择和八字计算
3. 添加实时八字显示功能

### 第二阶段：五行分析功能
1. 实现五行统计算法
2. 添加五行分布可视化
3. 开发失衡度分析功能

### 第三阶段：UI优化
1. 改进五行分布显示
   - 使用点状图表示数量
   - 区分先天和当下八字（方形/圆形）
2. 优化布局结构
   - 左右分栏设计
   - 响应式适配

## 重要决策记录

### 1. 五行显示方式
- 决策：采用点状显示替代进度条
- 原因：更直观地表现数量关系
- 实现：
  - 先天八字：圆形点
  - 当下八字：方形点
  - 横向排列，清晰显示数量

### 2. 数据更新策略
- 决策：每分钟更新当前八字
- 原因：平衡实时性和性能
- 实现：使用 setInterval 定时更新

### 3. 五行失衡分析
- 决策：采用百分比偏差分析
- 标准：
  - 理想比例：20%
  - 平衡：偏差 ≤5%
  - 轻度失衡：5% < 偏差 ≤ 10%
  - 严重失衡：偏差 > 10%

## 后续开发计划

1. **功能扩展**
   - [ ] 添加五行生克关系分析
   - [ ] 支持多种排盘方式
   - [ ] 添加命理详解功能

2. **性能优化**
   - [ ] 实现计算结果缓存
   - [ ] 优化组件重渲染逻辑

3. **用户体验**
   - [ ] 添加动画效果
   - [ ] 支持深色模式
   - [ ] 适配移动端显示 